<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PontoView • Previsão do Tempo</title>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --glass: rgba(255,255,255,.14);
      --glass2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.26);

      --text: rgba(255,255,255,.94);
      --dim: rgba(255,255,255,.78);
      --faint: rgba(255,255,255,.60);

      --shadow: 0 40px 120px rgba(0,0,0,.35);
      --r: 34px;

      /* Momento do dia (default: tarde) */
      --dayGlow1: rgba(38,198,207,.18);
      --dayGlow2: rgba(87,184,231,.14);
      --washTop:  rgba(7,22,36,.20);
      --washBot:  rgba(7,22,36,.42);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      overflow:hidden;

      background:
        radial-gradient(1400px 900px at 20% 15%, var(--dayGlow1), transparent 60%),
        radial-gradient(1000px 700px at 80% 75%, var(--dayGlow2), transparent 60%),
        url("assets/bg-blue.png");
      background-size: cover;
      background-position: center;

      transition: background 1.6s ease;
    }

    .wash{
      position:fixed;
      inset:0;
      background: linear-gradient(180deg, var(--washTop), var(--washBot));
      z-index:0;
      transition: background 1.6s ease;
    }

    .noise{
      position:fixed; inset:0; pointer-events:none; z-index:0;
      opacity:.08;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.4'/%3E%3C/svg%3E");
      background-size:180px 180px;
      mix-blend-mode:overlay;
    }

    .app{
      height:100%;
      display:grid;
      place-items:center;
      position:relative;
      z-index:1;
      padding: clamp(18px, 3vw, 42px);
    }

    .badge{
      padding: clamp(26px, 4.2vw, 54px) clamp(22px, 4.8vw, 64px);
      border-radius: var(--r);
      background: linear-gradient(135deg, var(--glass), var(--glass2));
      border: 1px solid var(--stroke);
      backdrop-filter: blur(22px);
      -webkit-backdrop-filter: blur(22px);
      box-shadow: var(--shadow);
      width: min(1100px, 92vw);

      opacity: 0;
      transform: translateY(18px) scale(.975);
      animation: enter 1.2s cubic-bezier(.22,1,.36,1) forwards;
    }

    @keyframes enter{
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 18px;
      flex-wrap:wrap;
    }

    .icon{
      width: 76px;
      height: 76px;
      display:grid;
      place-items:center;
      border-radius: 22px;
      background: rgba(255,255,255,.20);
      border: 1px solid rgba(255,255,255,.32);
      box-shadow: 0 14px 36px rgba(0,0,0,.25);
      flex: 0 0 auto;
    }
    .icon .material-icons-outlined{ font-size: 40px; color:#fff; }

    .titleBlock{
      flex: 1 1 360px;
      min-width: 280px;
    }
    .kicker{
      font-size: 14px;
      font-weight: 700;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: var(--dim);
    }
    .place{
      margin-top: 10px;
      display:flex;
      align-items:center;
      gap: 8px;
      font-size: clamp(16px, 1.7vw, 20px);
      font-weight: 700;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--text);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 62vw;
    }
    .place .material-icons-outlined{ font-size: 20px; opacity:.95; }

    .clockBox{
      margin-left:auto;
      text-align:right;
      min-width: 240px;
    }
    .clock{
      font-size: clamp(34px, 3.8vw, 48px);
      font-weight: 700;
      letter-spacing: .06em;
      line-height: 1;
    }
    .clockDate{
      margin-top: 8px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--dim);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .main{
      margin-top: clamp(18px, 2.6vw, 24px);
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 18px;
      align-items:stretch;
    }

    .card{
      border-radius: 22px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      padding: 18px 18px;
    }

    .nowRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      flex-wrap:wrap;
    }

    .tempBig{
      font-size: clamp(64px, 8.5vw, 110px);
      font-weight: 200;
      letter-spacing: .02em;
      line-height: 1;
    }
    .desc{
      margin-top: 10px;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--dim);
    }

    .metrics{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      width: min(360px, 100%);
    }
    .metric{
      border-radius: 14px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      padding: 10px 12px;
    }
    .metric .label{
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .16em;
      text-transform: uppercase;
      color: var(--faint);
    }
    .metric .val{
      margin-top: 6px;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: .06em;
      color: var(--text);
      white-space:nowrap;
    }

    .forecastTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 10px;
    }
    .forecastTitle span{
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: var(--dim);
    }

    .days{
      display:grid;
      gap: 10px;
    }

    .day{
      display:grid;
      grid-template-columns: 92px 1fr 120px;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
    }

    .dow{
      font-size: 12px;
      font-weight: 800;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: var(--text);
      opacity:.95;
    }

    .dmeta{
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--faint);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .hiLo{
      text-align:right;
      font-size: 14px;
      font-weight: 800;
      letter-spacing: .08em;
      color: var(--text);
      white-space:nowrap;
    }
    .hiLo .lo{ color: var(--dim); font-weight:700; }

    .footer{
      margin-top: 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--faint);
      flex-wrap:wrap;
    }

    .brand{
      position: fixed;
      bottom: 16px;
      right: 18px;
      opacity: .35;
      z-index:2;
      pointer-events:none;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.18));
    }
    .brand img{ height: 22px; width:auto; display:block; }

    @media (max-width: 980px){
      body{ overflow:auto; }
      .main{ grid-template-columns: 1fr; }
      .clockBox{ text-align:left; min-width:unset; }
      .place{ max-width: 100%; }
      .brand{ position: static; opacity:.55; padding: 0 18px 16px; }
    }
  </style>
</head>

<body>
  <div class="wash" aria-hidden="true"></div>
  <div class="noise" aria-hidden="true"></div>

  <main class="app">
    <section class="badge" aria-label="Painel de previsão do tempo">
      <div class="top">
        <div class="icon" aria-hidden="true">
          <span class="material-icons-outlined" id="wxIcon">cloud</span>
        </div>

        <div class="titleBlock">
          <div class="kicker">Previsão do Tempo</div>
          <div class="place" title="Local">
            <span class="material-icons-outlined" aria-hidden="true">location_on</span>
            <span id="place">Localizando…</span>
          </div>
        </div>

        <div class="clockBox" aria-label="Relógio e data">
          <div class="clock" id="clock">--:--</div>
          <div class="clockDate" id="clockDate">—</div>
        </div>
      </div>

      <div class="main">
        <!-- AGORA -->
        <div class="card">
          <div class="nowRow">
            <div>
              <div class="tempBig" id="tempNow">--°</div>
              <div class="desc" id="descNow">—</div>
            </div>

            <div class="metrics" aria-label="Métricas atuais">
              <div class="metric">
                <div class="label">Sensação</div>
                <div class="val" id="feels">—</div>
              </div>
              <div class="metric">
                <div class="label">Vento</div>
                <div class="val" id="wind">—</div>
              </div>
              <div class="metric">
                <div class="label">Umidade</div>
                <div class="val" id="humidity">—</div>
              </div>
              <div class="metric">
                <div class="label">Chuva</div>
                <div class="val" id="rain">—</div>
              </div>
            </div>
          </div>

          <div class="footer">
            <span id="updated">Atualizando…</span>
            <span>Sem API Key • Open-Meteo</span>
          </div>
        </div>

        <!-- PRÓXIMOS DIAS -->
        <div class="card">
          <div class="forecastTitle">
            <span>Próximos dias</span>
            <span id="range">—</span>
          </div>
          <div class="days" id="days"></div>
        </div>
      </div>
    </section>
  </main>

  <div class="brand" aria-hidden="true">
    <img src="assets/logo.png" alt="">
  </div>

  <script>
    /* ========= Relógio + Data ========= */
    const weekday = ["DOMINGO","SEGUNDA","TERÇA","QUARTA","QUINTA","SEXTA","SÁBADO"];
    const month   = ["JANEIRO","FEVEREIRO","MARÇO","ABRIL","MAIO","JUNHO","JULHO","AGOSTO","SETEMBRO","OUTUBRO","NOVEMBRO","DEZEMBRO"];
    const dowShort = ["DOM","SEG","TER","QUA","QUI","SEX","SÁB"];

    const clockEl = document.getElementById("clock");
    const clockDateEl = document.getElementById("clockDate");
    function pad2(n){ return String(n).padStart(2,"0"); }

    function updateClock(){
      const d = new Date();
      clockEl.textContent = `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
      clockDateEl.textContent = `${weekday[d.getDay()]}, ${pad2(d.getDate())} DE ${month[d.getMonth()]}`;
    }
    (function startClock(){
      updateClock();
      const ms = 1000 - new Date().getMilliseconds();
      setTimeout(() => { updateClock(); setInterval(updateClock, 1000); }, ms);
    })();

    /* ========= Momento do dia ========= */
    function applyDayMoment(){
      const hour = new Date().getHours();
      const root = document.documentElement;

      if (hour >= 6 && hour < 12){
        root.style.setProperty("--dayGlow1", "rgba(87,184,231,.30)");
        root.style.setProperty("--dayGlow2", "rgba(38,198,207,.24)");
        root.style.setProperty("--washTop",  "rgba(7,22,36,.14)");
        root.style.setProperty("--washBot",  "rgba(7,22,36,.32)");
      } else if (hour >= 12 && hour < 18){
        root.style.setProperty("--dayGlow1", "rgba(38,198,207,.20)");
        root.style.setProperty("--dayGlow2", "rgba(87,184,231,.16)");
        root.style.setProperty("--washTop",  "rgba(7,22,36,.20)");
        root.style.setProperty("--washBot",  "rgba(7,22,36,.42)");
      } else {
        root.style.setProperty("--dayGlow1", "rgba(31,95,168,.22)");
        root.style.setProperty("--dayGlow2", "rgba(11,42,85,.34)");
        root.style.setProperty("--washTop",  "rgba(7,22,36,.30)");
        root.style.setProperty("--washBot",  "rgba(7,22,36,.58)");
      }
    }
    applyDayMoment();
    setInterval(applyDayMoment, 10 * 60 * 1000);

    /* ========= UI refs ========= */
    const placeEl = document.getElementById("place");
    const wxIconEl = document.getElementById("wxIcon");
    const tempNowEl = document.getElementById("tempNow");
    const descNowEl = document.getElementById("descNow");
    const feelsEl = document.getElementById("feels");
    const windEl = document.getElementById("wind");
    const humidityEl = document.getElementById("humidity");
    const rainEl = document.getElementById("rain");
    const updatedEl = document.getElementById("updated");
    const daysEl = document.getElementById("days");
    const rangeEl = document.getElementById("range");

    /* ========= Helpers clima (Open-Meteo weathercode) ========= */
    function wxFromCode(code){
      // Ícones do Material + descrição (PT-BR)
      // referência: Open-Meteo weather codes (0..99)
      if (code === 0)  return { icon:"wb_sunny", desc:"CÉU LIMPO" };
      if (code === 1 || code === 2) return { icon:"partly_cloudy_day", desc:"PARCIALMENTE NUBLADO" };
      if (code === 3)  return { icon:"cloud", desc:"NUBLADO" };

      if (code === 45 || code === 48) return { icon:"foggy", desc:"NEBLINA" };

      if (code === 51 || code === 53 || code === 55) return { icon:"grain", desc:"GAROA" };
      if (code === 56 || code === 57) return { icon:"grain", desc:"GAROA CONGELANTE" };

      if (code === 61 || code === 63 || code === 65) return { icon:"rainy", desc:"CHUVA" };
      if (code === 66 || code === 67) return { icon:"rainy", desc:"CHUVA CONGELANTE" };

      if (code === 71 || code === 73 || code === 75) return { icon:"ac_unit", desc:"NEVE" };
      if (code === 77) return { icon:"ac_unit", desc:"GRÃOS DE NEVE" };

      if (code === 80 || code === 81 || code === 82) return { icon:"rainy", desc:"PANCADAS" };

      if (code === 85 || code === 86) return { icon:"ac_unit", desc:"NEVE (PANCADAS)" };

      if (code === 95) return { icon:"thunderstorm", desc:"TEMPESTADE" };
      if (code === 96 || code === 99) return { icon:"thunderstorm", desc:"TEMPESTADE FORTE" };

      return { icon:"cloud", desc:"CLIMA" };
    }

    function fmtDayLabel(isoDate){
      const d = new Date(isoDate + "T12:00:00");
      return dowShort[d.getDay()];
    }

    function fmtRange(startISO, endISO){
      const s = new Date(startISO + "T12:00:00");
      const e = new Date(endISO + "T12:00:00");
      const sTxt = `${pad2(s.getDate())}/${pad2(s.getMonth()+1)}`;
      const eTxt = `${pad2(e.getDate())}/${pad2(e.getMonth()+1)}`;
      return `${sTxt} – ${eTxt}`;
    }

    /* ========= Localização por IP (sem permissão) ========= */
    async function getIpLocation(){
      const r = await fetch("https://ipapi.co/json/", { cache:"no-store" });
      const d = await r.json();
      return {
        city: d?.city ? String(d.city) : null,
        region: d?.region_code ? String(d.region_code) : (d?.region ? String(d.region) : null),
        country: d?.country_code ? String(d.country_code) : null,
        lat: Number(d?.latitude),
        lon: Number(d?.longitude),
      };
    }

    /* ========= Clima (Open-Meteo, sem API key) ========= */
    async function fetchWeather(lat, lon){
      const url = new URL("https://api.open-meteo.com/v1/forecast");
      url.searchParams.set("latitude", String(lat));
      url.searchParams.set("longitude", String(lon));
      url.searchParams.set("timezone", "auto");
      url.searchParams.set("current", "temperature_2m,apparent_temperature,relative_humidity_2m,precipitation,weather_code,wind_speed_10m");
      url.searchParams.set("daily", "weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max");
      url.searchParams.set("forecast_days", "6"); // hoje + 5
      const r = await fetch(url.toString(), { cache:"no-store" });
      return r.json();
    }

    function renderDaily(daily){
      daysEl.innerHTML = "";
      const times = daily.time || [];
      const code = daily.weather_code || [];
      const tmax = daily.temperature_2m_max || [];
      const tmin = daily.temperature_2m_min || [];
      const pop  = daily.precipitation_probability_max || [];

      if (!times.length){
        daysEl.innerHTML = `<div style="color:var(--dim); letter-spacing:.14em; text-transform:uppercase; font-weight:700;">Sem dados.</div>`;
        return;
      }

      rangeEl.textContent = fmtRange(times[0], times[times.length - 1]);

      const frag = document.createDocumentFragment();
      for (let i=0;i<times.length;i++){
        const w = wxFromCode(code[i]);
        const el = document.createElement("div");
        el.className = "day";
        el.innerHTML = `
          <div class="dow">${fmtDayLabel(times[i])}</div>
          <div class="dmeta">${w.desc}${Number.isFinite(pop[i]) ? ` • CHUVA ${pop[i]}%` : ""}</div>
          <div class="hiLo">
            ${Math.round(tmax[i])}° <span class="lo">/ ${Math.round(tmin[i])}°</span>
          </div>
        `;
        frag.appendChild(el);
      }
      daysEl.appendChild(frag);
    }

    function setUpdated(){
      const d = new Date();
      updatedEl.textContent = `ATUALIZADO • ${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
    }

    async function refresh(){
      try{
        placeEl.textContent = "LOCALIZANDO…";
        const loc = await getIpLocation();

        const placeTxt =
          (loc.city && loc.region) ? `${loc.city.toUpperCase()} - ${loc.region.toUpperCase()}` :
          (loc.city && loc.country) ? `${loc.city.toUpperCase()} - ${loc.country.toUpperCase()}` :
          (loc.city) ? loc.city.toUpperCase() :
          "LOCAL NÃO IDENTIFICADO";

        placeEl.textContent = placeTxt;

        if (!Number.isFinite(loc.lat) || !Number.isFinite(loc.lon)){
          descNowEl.textContent = "SEM LOCALIZAÇÃO";
          tempNowEl.textContent = "--°";
          return;
        }

        const data = await fetchWeather(loc.lat, loc.lon);

        const cur = data.current || {};
        const w = wxFromCode(cur.weather_code);

        wxIconEl.textContent = w.icon;
        descNowEl.textContent = w.desc;

        const t = Number(cur.temperature_2m);
        tempNowEl.textContent = Number.isFinite(t) ? `${Math.round(t)}°` : "--°";

        const feels = Number(cur.apparent_temperature);
        feelsEl.textContent = Number.isFinite(feels) ? `${Math.round(feels)}°C` : "—";

        const wind = Number(cur.wind_speed_10m);
        windEl.textContent = Number.isFinite(wind) ? `${Math.round(wind)} km/h` : "—";

        const hum = Number(cur.relative_humidity_2m);
        humidityEl.textContent = Number.isFinite(hum) ? `${Math.round(hum)}%` : "—";

        const rain = Number(cur.precipitation);
        rainEl.textContent = Number.isFinite(rain) ? `${rain.toFixed(1)} mm` : "—";

        if (data.daily) renderDaily(data.daily);
        setUpdated();
      } catch (e){
        placeEl.textContent = "SEM CONEXÃO";
        descNowEl.textContent = "NÃO FOI POSSÍVEL ATUALIZAR";
        setUpdated();
        console.warn(e);
      }
    }

    // Boot
    refresh();
    // Atualiza previsão a cada 20 min (bom para painel)
    setInterval(refresh, 20 * 60 * 1000);
  </script>
</body>
</html>
